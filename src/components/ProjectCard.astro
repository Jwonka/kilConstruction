---
export interface Props {
    p: {
        slug: string;
        name: string;
        summary?: string;
        year?: string | number;
        location?: string;
    };
    first?: { name?: string; url?: string } | string;
    src?: string;
    rotList?: string[];
    eager?: boolean;
    cover?: string;
    baseHref?: string;
}

const { p, first, src, rotList = [], eager = false, cover, baseHref = "/projects", } = Astro.props;

const safeBase = baseHref.endsWith("/") ? baseHref.slice(0, -1) : baseHref;
const href = `${safeBase}/${p.slug}`;

const firstUrl = typeof first === 'string' ? first : first?.url;
const firstName = typeof first === 'string' ? undefined : first?.name;

// pick ONE primary image URL, in this order:
const primary =
    cover ||
    (Array.isArray(rotList) && rotList.length > 0 ? rotList[0] : undefined) ||
    firstUrl ||
    src;

const mainSrc = primary;
const srcset = undefined;
const sizes = '(max-width: 720px) 96vw, (max-width: 1200px) 45vw, 680px';

// only set data-rot if there are multiple images
const dataRot = Array.isArray(rotList) && rotList.length > 1 ? rotList.join(',') : undefined;
---

<figure class="card card-media" style="object-fit: cover">
    <a href={href} aria-label={p.name}>
        <img
            class="photo"
            {...(dataRot ? { 'data-rot-srcs': JSON.stringify(rotList) } : {})}
            src={mainSrc}
            alt={firstName || p.name}
            srcset={srcset}
            data-cover={primary}
            sizes={sizes}
            width="1200" height="900"
            style="aspect-ratio: var(--ratio-projects); object-fit: cover;"
            loading={eager ? 'eager' : 'lazy'}
            fetchpriority={eager ? 'high' : 'auto'}
            decoding={eager ? 'sync' : 'async'}
            referrerpolicy="no-referrer"/>
    </a>
    <figcaption class="caption">{p.name}</figcaption>
</figure>