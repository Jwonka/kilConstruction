---

---
<h1>Admin: Upload Project Photos</h1>
<form id="uform" class="card" enctype="multipart/form-data" novalidate>
    <label for="auth">Secret</label>
    <input id="auth" name="auth" type="password" required placeholder="Upload secret" />

    <label for="file">Photo(s)</label>
    <input id="file" name="file" type="file" accept="image/*" multiple required />

    <button class="btn">Upload</button>
    <p id="status" aria-live="polite"></p>
</form>

<script>
    const api = import.meta.env.PUBLIC_GALLERY_API as string;

    // Typed DOM lookups + null guards
    const form = document.querySelector<HTMLFormElement>('#uform');
    const statusEl = document.querySelector<HTMLParagraphElement>('#status');

    if (form && statusEl) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const secret = new FormData(form).get('auth') as string | null;

            // Find the file input *inside* the form and read files safely
            const fileInput = form.elements.namedItem('file') as HTMLInputElement | null;
            const files = fileInput?.files ? Array.from(fileInput.files) : [];

            if (!secret || files.length === 0) {
                statusEl.textContent = 'Missing secret or no files selected.';
                return;
            }

            statusEl.textContent = 'Uploading...';
            let ok = 0, fail = 0;

            for (const f of files) {
                const body = new FormData();
                body.append('file', f, f.name);

                const res = await fetch(api, {
                    method: 'POST',
                    headers: { 'X-Auth': secret },
                    body
                });

                res.ok ? ok++ : fail++;
            }

            statusEl.textContent = `Done. ${ok} uploaded, ${fail} failed.`;
        });
    }
</script>

