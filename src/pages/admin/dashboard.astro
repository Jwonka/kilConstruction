---
import AdminLayout from "../../layout/AdminLayout.astro";
import "../../styles/global.css";
import "../../styles/admin.css";
import { verifyAdminToken } from "../../utils/adminToken";

const cookies = Astro.cookies;
const auth = cookies.get("admin_auth")?.value || "";
const env = (Astro.locals as any).runtime?.env ?? {};
const ADMIN_SECRET = env.ADMIN_SECRET;

const isAdmin = ADMIN_SECRET
    ? await verifyAdminToken(auth, ADMIN_SECRET)
    : false;

if (!isAdmin) {
    return new Response(null, {
        status: 302,
        headers: { Location: "/admin" },
    });
}
---
<AdminLayout title="Admin Dashboard" description="Admin dashboard.">
    <h1 class="admin-title">Admin Dashboard</h1>

    <nav class="admin-actions">
        <a href="/admin/upload" class="btn admin-btn">
            <span class="icon" aria-hidden="true">ğŸ“¤</span>
            <span>Upload Images</span>
        </a>

        <a href="/admin/manage" class="btn admin-btn">
            <span class="icon" aria-hidden="true">ğŸ“</span>
            <span>Manage Images</span>
        </a>

        <a href="/admin/reviews" class="btn admin-btn">
            <span class="icon" aria-hidden="true">ğŸ“</span>
            <span>Moderate Reviews</span>
        </a>
    </nav>
</AdminLayout>