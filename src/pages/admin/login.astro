---
const cookies = Astro.cookies;

if (Astro.request.method === 'POST') {
    const contentType = Astro.request.headers.get('content-type') || '';

    if (
        contentType.includes('application/x-www-form-urlencoded') ||
        contentType.includes('multipart/form-data')
    ) {
        const formData = await Astro.request.formData();
        const username = formData.get('username');
        const password = formData.get('password');

        if (username === import.meta.env.ADMIN_USER && password === import.meta.env.ADMIN_PASS) {
            cookies.set('admin_auth', import.meta.env.ADMIN_SECRET, {
                path: '/',
                httpOnly: true,
                secure: import.meta.env.PROD,
                sameSite: 'strict',
                maxAge: 60 * 60 * 24,
            });

            return new Response(null, {
                status: 302,
                headers: { Location: '/admin/dashboard' }
            });
        } else {
            return new Response('Invalid credentials', { status: 401 });
        }
    } else {
        return new Response('Unsupported Content-Type', { status: 415 });
    }
}
---

<html>
<head>
    <title>Admin Login</title>
</head>
<body>
<h1>Admin Login</h1>
<form method="POST">
    <label>
        Username:
        <input type="text" name="username" required />
    </label>
    <br />
    <label>
        Password:
        <input type="password" name="password" required />
    </label>
    <br />
    <button type="submit">Login</button>
</form>
</body>
</html>