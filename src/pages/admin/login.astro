---
import { AstroCookies } from 'astro:middleware';
const cookies = AstroCookies();

if (Astro.request.method === 'POST') {
    const formData = await Astro.request.formData();
    const username = formData.get('username');
    const password = formData.get('password');

    if (username === import.meta.env.ADMIN_USER && password === import.meta.env.ADMIN_PASS) {
        cookies.set('admin_auth', import.meta.env.ADMIN_SECRET, { path: '/' });
        return new Response(null, {
            status: 302,
            headers: { Location: '/admin/dashboard' }
        });
    } else {
        return new Response('Invalid credentials', { status: 401 });
    }
}
---

<html>
<head>
    <title>Admin Login</title>
</head>
<body>
<h1>Admin Login</h1>
<form method="POST">
    <label>
        Username:
        <input type="text" name="username" required />
    </label>
    <br />
    <label>
        Password:
        <input type="password" name="password" required />
    </label>
    <br />
    <button type="submit">Login</button>
</form>
</body>
</html>