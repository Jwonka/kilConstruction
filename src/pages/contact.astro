---
import MainLayout from "../layout/MainLayout.astro";
import bizcard from "../assets/bizcard-front-new.jpg";
const base = import.meta.env.BASE_URL;
/** CONTACT FORM via Web3Forms (free tier)
 * 1) Sign up at https://web3forms.com and get an access_key.
 * 2) Replace YOUR_ACCESS_KEY below.
 * 3) Set the "from_name" and "subject" to something recognizable in the owner's inbox.
 */

const ACCESS_KEY = "YOUR_ACCESS_KEY";
---
<MainLayout title="Contact | KIL Construction">
    <h1 class="contact-title">Request a Free Quote</h1>

    <div class="contact-grid">
        <!-- LEFT: quick info -->
        <section class="card contact-panel">
            <h2 class="heading2">Reach us directly</h2>
            <p><strong>Call / Text:</strong> <a href="tel:+17152791241">(715) 279-1241</a></p>
            <p><strong>Email:</strong> <a href="mailto:kil.con.contact@gmail.com">kil.con.contact@gmail.com</a></p>
            <p><strong>Facebook:</strong> <a href="https://www.facebook.com/profile.php?id=61559555097375" target="_blank" rel="noopener">KIL Construction</a></p>
            <p><a class="btn btn-vcard" href={`${base}KIL-Construction.vcf`} download>Download vCard</a></p>

            <a class="vcard-click" href={`${base}KIL-Construction.vcf`} download>
                <figure class="bizcard">
                    <img class="image-card" src={bizcard.src} alt="KIL Construction business card" loading="lazy" />
                </figure>
            </a>
        </section>

        <!-- RIGHT: form -->
        <section class="card contact-panel">
            <h2>Tell us about your project</h2>
            <div id="result" class="result" aria-live="polite"></div>
            <form class="contact-form" method="POST" action={import.meta.env.PUBLIC_CONTACT_ENDPOINT}>
                <input type="hidden" name="access_key" value={ACCESS_KEY} />
                <input type="hidden" name="from_name" value="kilcon.work website" />
                <input type="hidden" name="subject" value="New Quote Request from kilcon.work" />

                <label for="name">Name</label>
                <input id="name" name="name" required />

                <label for="email">Email</label>
                <input id="email" name="email" type="email" required />

                <label for="phone">Phone (optional)</label>
                <input id="phone" name="phone" inputmode="tel" />

                <label for="address">Job Address (optional)</label>
                <input id="address" name="address" />

                <label for="message">Project Details</label>
                <textarea id="message" name="message" rows="6" required minlength="10"></textarea>

                <input type="text" name="company" tabindex="-1" autocomplete="off" style="display:none" />

                <!-- Turnstile widget  -->
                <div class="cf-turnstile" data-sitekey={String(import.meta.env.PUBLIC_TURNSTILE_SITE_KEY)}></div>
                <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" defer></script>

                <button class="btn" type="submit">Send</button>

            </form>
        </section>
    </div>
    <script is:inline>
        (function () {
            const res = document.getElementById('result');
            if (!res) return;
            const sent = url.searchParams.get('sent');
            const err  = url.searchParams.get('err');
            const url = new URL(window.location.href);
            if (url.searchParams.get('sent') === '1') {
                res.textContent = "Thanks! Weâ€™ll be in touch shortly.";
                res.classList.add('ok');
                url.searchParams.delete('sent');
                // silence the IntelliJ warning: explicitly ignore return value
                void window.history.replaceState(null, "", url.pathname + url.search);
            } else if (err) {
                res.textContent = err === 'captcha'
                    ? "Please complete the CAPTCHA and try again."
                    : "Sorry, something went wrong. Please try again.";
                res.classList.add('error');
                url.searchParams.delete('err');
                history.replaceState({}, "", url.pathname + url.search);
            }
        })();
    </script>
    <style>
        .contact-title{
            text-align:center;
            margin: 28px 0 18px;
        }
        .contact-grid{
            display:grid;
            gap: clamp(16px, 2.5vw, 28px);
            grid-template-columns: 1fr 1fr;
            align-items:start;
            margin-bottom: 24px;
        }
        .contact-panel{padding: clamp(14px, 2vw, 20px);}
        .contact-panel .heading2{margin: 0 0 8px;font-size: clamp(1.1rem, 1.3vw + .9rem, 1.6rem);}
        .contact-grid > .contact-panel:first-child{position: sticky;top: calc(var(--header-h, 84px) + 16px);}
        .contact-grid > .contact-panel:last-child{margin-bottom: 0;}
        .bizcard{
            margin:14px 0 0;
            border-radius:12px;
            overflow:hidden;
            background: transparent;
            box-shadow:
                    -10px 12px 18px rgba(0,0,0,.28),
                    0 0 0 1px rgba(0,0,0,.06);
            transform: translateZ(0);
            will-change: transform, box-shadow;
            transition: transform .18s ease, box-shadow .18s ease;
        }
        .bizcard .image-card{
            display:block;
            width: calc(100% + 4px);
            height:auto;
            margin: -2px;
            border:0;
            border-radius: inherit;
            image-rendering: auto;
            transform: none;
        }
        .vcard-click { display:block; text-decoration:none; }
        .vcard-click .bizcard .image-card{transition: transform .15s ease, box-shadow .15s ease;}
        .vcard-click:hover .bizcard,
        .vcard-click:focus-visible .bizcard{
            transform: translate(-1px,-2px);
            box-shadow:
                    -16px 18px 26px rgba(0,0,0,.38),
                    0 0 0 1px rgba(0,0,0,.06);
            cursor: pointer;
        }
        .card { overflow: hidden; }
        .contact-form, .contact-form .btn { min-width: 0; }
        .contact-form{
            display:grid;
            gap: 10px;
        }

        .result { font-size: .95rem;color: var(--muted);margin: 12px 0; padding: 10px 12px; border-radius: 8px; font-weight: 600; }
        .result.ok    { background: #ecfdf3; color: #065f46; border: 1px solid #a7f3d0; }
        .result.error { background: #fef2f2; color: #991b1b; border: 1px solid #fecaca; }

        /* Mobile: stack */
        @media (max-width: 840px){
            .contact-form .btn {
                display: block;
                width: 100%;
                max-width: 100%;
                justify-self: stretch;
            }
            .contact-grid{ grid-template-columns: 1fr; }
        }
    </style>
</MainLayout>