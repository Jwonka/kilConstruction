---
import MainLayout from "../layout/MainLayout.astro";
import bizcard from "../assets/bizcard-front-new.jpg";
import "../styles/global.css";
import "../styles/contact.css";

const base = import.meta.env.BASE_URL;
/** CONTACT FORM via Web3Forms (free tier)
 * 1) Sign up at https://web3forms.com and get an access_key.
 * 2) Set the "from_name" and "subject" to something recognizable in the owner's inbox.
 */

const ACCESS_KEY = "YOUR_ACCESS_KEY";
const SITEKEY = import.meta.env.PUBLIC_TURNSTILE_SITE_KEY;
const ENDPOINT = import.meta.env.PUBLIC_CONTACT_ENDPOINT;
---
<MainLayout title="Contact | KIL Construction">
    <h1 class="contact-title">Request a Free Quote</h1>

    <div class="contact-grid">
        <!-- LEFT: quick info -->
        <section class="card contact-panel">
            <h2 class="heading2">Reach us directly</h2>
            <p><strong>Call / Text:</strong> <a href="tel:+17152791241">(715) 279-1241</a></p>
            <p><strong>Email:</strong> <a href="mailto:kil.con.contact@gmail.com">kil.con.contact@gmail.com</a></p>
            <p><strong>Facebook:</strong> <a href="https://www.facebook.com/profile.php?id=61559555097375" target="_blank" rel="noopener">KIL Construction</a></p>
            <p><a class="btn btn-vcard" href={`${base}KIL-Construction.vcf`} download>Download vCard</a></p>

            <a class="vcard-click" href={`${base}KIL-Construction.vcf`} download>
                <figure class="bizcard">
                    <img class="image-card" src={bizcard.src} alt="KIL Construction business card" loading="lazy" />
                </figure>
            </a>
        </section>

        <!-- RIGHT: form -->
        <section class="card contact-panel">
            <h2>Tell us about your project</h2>
            <div id="result" class="result" aria-live="polite"></div>
            <form class="contact-form" method="POST" action={import.meta.env.PUBLIC_CONTACT_ENDPOINT}>
                <input type="hidden" name="access_key" value={ACCESS_KEY} />
                <input type="hidden" name="from_name" value="kilcon.work website" />
                <input type="hidden" name="subject" value="New Quote Request from kilcon.work" />

                <label for="name">Name</label>
                <input id="name" name="name" required placeholder="John Doe" />

                <label for="email">Email</label>
                <input id="email" name="email" type="email" required placeholder="example@gmail.com"/>

                <label for="phone">Phone (optional)</label>
                <input id="phone" name="phone" type="tel" inputmode="tel" pattern="[0-9()+\-\s]{7,20}" autocomplete="tel" placeholder="(715) 867-5309"/>

                <label for="address">Job Address (optional)</label>
                <input id="address" name="address" placeholder="123 Easy St."/>

                <label for="message">Project Details</label>
                <textarea id="message" name="message" rows="6" required minlength="10" placeholder="A brief description of your project."></textarea>

                <!-- Honeypot -->
                <label>
                    <input type="text" name="company" tabindex="-1" autocomplete="off" style="display:none" />
                </label>

                <!-- Turnstile widget  -->
                <div
                    id="cf-container"
                    class="cf-turnstile"
                    data-sitekey={SITEKEY}
                    data-theme="auto"
                    data-size="normal"
                    data-refresh-expired="auto">
                </div>


                <button class="btn" type="submit">Send</button>
            </form>

            <!-- Turnstile loader -->
            <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
        </section>
    </div>
    <script is:inline>
        (function () {
            const res = document.getElementById('result');
            if (!res) return;
            const url = new URL(window.location.href);
            const sent = url.searchParams.get('sent');
            const err  = url.searchParams.get('err');
            if (url.searchParams.get('sent') === '1') {
                res.textContent = "Thanks! Weâ€™ll be in touch shortly.";
                res.classList.add('ok');
                url.searchParams.delete('sent');
                void window.history.replaceState(null, "", url.pathname + url.search);
            } else if (err) {
                res.textContent = err === 'captcha'
                    ? "Please complete the CAPTCHA and try again."
                    : "Sorry, something went wrong. Please try again.";
                res.classList.add('error');
                url.searchParams.delete('err');
                history.replaceState({}, "", url.pathname + url.search);
            }
        })();
    </script>
</MainLayout>